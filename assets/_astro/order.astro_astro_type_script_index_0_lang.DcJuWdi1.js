document.addEventListener("DOMContentLoaded",function(){function C(r){const t=document.getElementById("ah-lead-overlay");window.__ahProductType=r,t?.classList.remove("ah-hidden"),t?.setAttribute("aria-hidden","false"),document.getElementById("ah-first")?.focus()}function y(){const r=document.getElementById("ah-lead-overlay");r?.classList.add("ah-hidden"),r?.setAttribute("aria-hidden","true")}document.getElementById("ah-lead-close")?.addEventListener("click",y),document.addEventListener("keydown",r=>{r.key==="Escape"&&y()});async function k(r){try{const t=new AbortController,i=setTimeout(()=>t.abort(),4500),a=await fetch("/api/ah-register-lite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:t.signal});clearTimeout(i);const n=await a.json().catch(()=>({}));return a.ok&&n.success!==!1}catch{return!1}}async function L(r,t){const i=document.getElementById("ah-lead-form"),a=document.getElementById("ah-lead-error");if(document.getElementById("ah-lead-overlay")?.classList.contains("ah-hidden")){const e=document.querySelector(".tab-button.active"),s=e&&e.getAttribute("data-product")||"alpha";C(s)}if(!i)return!1;const o=await new Promise(e=>{function s(c){c.preventDefault(),a.style.display="none";const m=document.getElementById("ah-first").value.trim(),l=document.getElementById("ah-last").value.trim(),u=document.getElementById("ah-email").value.trim(),p=document.getElementById("ah-pass").value,b=document.getElementById("ah-pass2").value;if(!m||!l||!u||!p||!b){a.textContent="Please complete all fields.",a.style.display="block";return}if(p.length<8){a.textContent="Password must be at least 8 characters.",a.style.display="block";return}if(p!==b){a.textContent="Passwords do not match.",a.style.display="block";return}i.removeEventListener("submit",s),e({first:m,last:l,email:u,pass:p,pass2:b})}i.addEventListener("submit",s)});try{await r.checkout.updateAttributes(t,{customAttributes:[{key:"ah_email",value:o.email},{key:"ah_first_name",value:o.first},{key:"ah_last_name",value:o.last},{key:"ah_product_type",value:window.__ahProductType||"alpha"}]})}catch(e){console.warn("Shopify attributes failed (continuing):",e)}return await k({email:o.email,firstName:o.first,lastName:o.last,productType:"1",password:o.pass,password_confirmation:o.pass2}),y(),!0}const T={alpha:{images:[{src:"/alpha-main.jpg",alt:"Alpha Main"},{src:"/alpha-alt1.webp",alt:"Alpha Alt 1"},{src:"/alpha-alt2.jpg",alt:"Alpha Alt 2"},{src:"/alpha-alt3.jpg",alt:"Alpha Alt 3"}]},charisma:{images:[{src:"/charisma-main.webp",alt:"Charisma Main"},{src:"/charisma-alt1.jpg",alt:"Charisma Alt 1"},{src:"/charisma-alt2.jpg",alt:"Charisma Alt 2"}]},"alpha-charisma":{images:[{src:"/alphaandring.jpg",alt:"Alpha + Charisma Bundle"},{src:"/alpha-main.jpg",alt:"Alpha Wearable"},{src:"/charisma-main.webp",alt:"Charisma Ring"}]},frequana:{images:[{src:"/frequana-main.JPG",alt:"Frequana Main"},{src:"/frequana-alt1.JPG",alt:"Frequana Alt 1"},{src:"/frequana-alt2.png",alt:"Frequana Alt 2"}]},bundle:{images:[{src:"/pack-bundle.jpg",alt:"Complete Bundle"},{src:"/alpha-main.jpg",alt:"Alpha Included"},{src:"/charisma-main.webp",alt:"Charisma Included"},{src:"/frequana-main.JPG",alt:"Frequana Included"}]}},f=document.querySelectorAll(".tab-button"),v=document.querySelectorAll(".product-content"),h=document.getElementById("main-product-image"),d=document.getElementById("thumbnail-grid");function w(r){const t=T[r]?.images;if(!t||!h||!d)return;h.src=t[0].src,h.alt=t[0].alt,d.innerHTML="";function i(){const n=window.innerWidth;return n<=320?"50px":n<=375?"55px":n<=480?"60px":n<=768?"70px":"80px"}function a(){const n=window.innerWidth;return n<=320?"6px":n<=480?"8px":"12px"}t.forEach((n,o)=>{const e=document.createElement("img");e.className=`thumbnail ${o===0?"active":""}`,e.src=n.src,e.alt=n.alt,e.dataset.main=n.src;const s=i();e.style.width=s,e.style.height=s,e.style.minWidth=s,e.style.minHeight=s,e.style.maxWidth=s,e.style.maxHeight=s,e.style.objectFit="cover",e.style.borderRadius="8px",e.style.cursor="pointer",e.style.border=o===0?"2px solid #2596be":"2px solid transparent",e.style.display="block",e.style.flexShrink="0",e.style.boxSizing="border-box",e.addEventListener("click",function(){d.querySelectorAll(".thumbnail").forEach(c=>{c.classList.remove("active"),c.style.border="2px solid transparent"}),this.classList.add("active"),this.style.border="2px solid #2596be",h.src=this.dataset.main||"",h.alt=this.alt}),d.appendChild(e)}),d.style.display="flex",d.style.gap=a(),d.style.flexWrap="wrap",d.style.alignItems="flex-start"}f.forEach(r=>{r.addEventListener("click",function(){const t=this.dataset.product;f.forEach(a=>a.classList.remove("active")),this.classList.add("active"),v.forEach(a=>a.classList.remove("active"));const i=document.querySelector(`.product-content[data-product="${t}"]`);i&&i.classList.add("active"),w(t)})});const x=document.querySelectorAll(".detail-tab"),q=document.querySelectorAll(".detail-panel");x.forEach(r=>{r.addEventListener("click",function(){const t=this.dataset.tab;x.forEach(a=>a.classList.remove("active")),q.forEach(a=>a.classList.remove("active")),this.classList.add("active");const i=document.querySelector(`.detail-panel[data-panel="${t}"]`);i&&i.classList.add("active")})});const g=new URLSearchParams(window.location.search).get("product");function A(r){f.forEach(a=>a.classList.remove("active"));const t=document.querySelector(`.tab-button[data-product="${r}"]`);t&&t.classList.add("active"),v.forEach(a=>a.classList.remove("active"));const i=document.querySelector(`.product-content[data-product="${r}"]`);i&&i.classList.add("active"),w(r)}const S=g&&["alpha","charisma","alpha-charisma","frequana","bundle"].includes(g)?g:"alpha";A(S);function I(){const r=document.querySelectorAll("#thumbnail-grid .thumbnail"),t=document.getElementById("thumbnail-grid");if(r.length===0||!t)return;function i(){const e=window.innerWidth;return e<=320?"50px":e<=375?"55px":e<=480?"60px":e<=768?"70px":"80px"}function a(){const e=window.innerWidth;return e<=320?"6px":e<=480?"8px":"12px"}const n=i(),o=a();r.forEach(e=>{e.style.width=n,e.style.height=n,e.style.minWidth=n,e.style.minHeight=n,e.style.maxWidth=n,e.style.maxHeight=n}),t.style.gap=o}let E;window.addEventListener("resize",function(){clearTimeout(E),E=setTimeout(I,150)}),setTimeout(I,100);class P{constructor(){this.client=null,this.cartId=null,this.init()}async init(){typeof ShopifyBuy<"u"&&window.SHOPIFY_CLIENT?(this.client=window.SHOPIFY_CLIENT,await this.getOrCreateCart(),this.bindEvents(),console.log("✅ Shopify Cart API inicializado")):setTimeout(()=>this.init(),500)}async getOrCreateCart(){const t=localStorage.getItem("shopify-cart-id");if(t)try{const a=await this.client.checkout.fetch(t);if(!a.completedAt){this.cartId=t,this.updateCartUI(a);return}}catch{console.log("Carrito anterior no válido, creando nuevo")}const i=await this.client.checkout.create();this.cartId=i.id,localStorage.setItem("shopify-cart-id",this.cartId),this.updateCartUI(i)}bindEvents(){document.querySelectorAll(".shopify-add-item").forEach(i=>{i.addEventListener("click",async a=>{a.preventDefault();const n=a.currentTarget.dataset.variantId,o=a.currentTarget.dataset.productTitle;await this.addToCart(n,1,o)})});const t=document.getElementById("cart-button");t&&t.addEventListener("click",i=>{i.preventDefault(),this.showCartModal()})}async addToCart(t,i,a){try{const n=[{variantId:`gid://shopify/ProductVariant/${t}`,quantity:i}],o=await this.client.checkout.addLineItems(this.cartId,n);this.updateCartUI(o),this.showNotification(`${a} added to cart`)}catch(n){console.error("Error adding to cart:",n),this.showNotification("Error adding product to cart")}}async removeFromCart(t){try{const i=await this.client.checkout.removeLineItems(this.cartId,[t]);this.updateCartUI(i),this.showNotification("Product removed from cart")}catch(i){console.error("Error removing from cart:",i),this.showNotification("Error removing product")}}async updateQuantity(t,i){try{if(i<=0){await this.removeFromCart(t);return}const a=await this.client.checkout.updateLineItems(this.cartId,[{id:t,quantity:i}]);this.updateCartUI(a)}catch(a){console.error("Error updating quantity:",a),this.showNotification("Error updating quantity")}}async showCartModal(){if(this.cartId)try{const t=await this.client.checkout.fetch(this.cartId);this.createCartModal(t)}catch(t){console.error("Error fetching cart:",t)}}createCartModal(t){const i=document.getElementById("cart-modal");i&&i.remove();const a=document.createElement("div");a.id="cart-modal",a.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10000;display:flex;justify-content:center;align-items:center;font-family:var(--base-font);";const n=document.createElement("div");n.style.cssText="background:white;border-radius:12px;padding:30px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;position:relative;";let o="";t.lineItems&&t.lineItems.length>0?t.lineItems.forEach(e=>{o+=`
            <div class="cart-item" style="display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid #e2e8f0;">
              <div style="flex:1;">
                <h4 style="margin:0 0 5px 0;font-size:1.6rem;">${e.title}</h4>
                <p style="margin:0;color:#666;font-size:1.5rem;">$${e.variant.price.amount}</p>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <button class="qty-btn" data-action="decrease" data-line-id="${e.id}" style="width:20px;height:40px;border:1px solid #ddd;background:white;border-radius:4px;cursor:pointer;">-</button>
                <span style="min-width:20px;text-align:center;font-weight:600;">${e.quantity}</span>
                <button class="qty-btn" data-action="increase" data-line-id="${e.id}" style="width:20px;height:40px;border:1px solid #ddd;background:white;border-radius:4px;cursor:pointer;">+</button>
                <button class="remove-btn" data-line-id="${e.id}" style="background:#ef4444;color:white;border:none;padding:0px 10px;border-radius:4px;cursor:pointer;margin-left:10px;">Remove</button>
              </div>
            </div>`}):o='<p style="text-align:center;color:#666;padding:40px 0;">Your cart is empty</p>',n.innerHTML=`
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <h3 style="margin:0;color:#1a202c;">Shopping Cart</h3>
          <button id="close-modal" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">&times;</button>
        </div>
        <div id="cart-items">${o}</div>
        ${t.lineItems&&t.lineItems.length>0?`
          <div style="border-top:2px solid #e2e8f0;padding-top:20px;margin-top:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <strong style="font-size:1.8rem;">Total: $${t.totalPrice.amount}</strong>
            </div>
            <button id="checkout-btn" style="width:100%;background:#2596be;color:white;border:none;padding:0px;border-radius:8px;font-size:1.1rem;font-weight:600;cursor:pointer;">
              Proceed to Checkout
            </button>
          </div>`:""}
      `,a.appendChild(n),document.body.appendChild(a),document.getElementById("close-modal").addEventListener("click",()=>a.remove()),a.addEventListener("click",e=>{e.target===a&&a.remove()}),t.lineItems&&t.lineItems.length>0&&document.getElementById("checkout-btn").addEventListener("click",async()=>{const e=document.querySelector(".tab-button.active"),s=e&&e.getAttribute("data-product")||"1";window.__ahProductType=s;try{await L(this.client,this.cartId)}finally{a.remove(),this.openShopifyCheckout()}}),document.querySelectorAll(".qty-btn").forEach(e=>{e.addEventListener("click",async s=>{const c=s.currentTarget.dataset.lineId,m=s.currentTarget.dataset.action,l=t.lineItems.find(u=>u.id===c);if(l){const u=m==="increase"?l.quantity+1:l.quantity-1;await this.updateQuantity(c,u),a.remove(),setTimeout(()=>this.showCartModal(),100)}})}),document.querySelectorAll(".remove-btn").forEach(e=>{e.addEventListener("click",async s=>{const c=s.currentTarget.dataset.lineId;await this.removeFromCart(c),a.remove(),setTimeout(()=>this.showCartModal(),100)})})}async openShopifyCheckout(){if(this.cartId)try{const t=await this.client.checkout.fetch(this.cartId);window.location.href=t.webUrl}catch(t){console.error("Error opening checkout:",t)}}updateCartUI(t){const i=document.querySelector(".shopify-cart-count");if(i&&t.lineItems){const a=t.lineItems.reduce((n,o)=>n+o.quantity,0);i.textContent=a.toString()}}showNotification(t){const i=document.createElement("div");i.style.cssText="position:fixed;top:20px;right:20px;background:#2596be;color:white;padding:15px 20px;border-radius:8px;z-index:10000;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.1);font-family:var(--base-font);",i.textContent=t,document.body.appendChild(i),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},3e3)}}window.shopifyCart=new P});
