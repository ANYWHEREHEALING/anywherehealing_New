document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector(".product-video"),l=document.querySelector(".video-container");if(o&&l){let t;t=setTimeout(()=>{console.log("Video loading timeout")},1e4),o.addEventListener("error",function(n){console.log("Video loading error:",n),clearTimeout(t)}),o.addEventListener("loadeddata",function(){console.log("Video loaded successfully"),clearTimeout(t)}),o.addEventListener("canplay",function(){clearTimeout(t)});const e=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&(o.preload="auto",e.unobserve(o))})});e.observe(o)}});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('a[href^="#"]').forEach(o=>{o.addEventListener("click",function(l){l.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})})});document.addEventListener("DOMContentLoaded",function(){const o=document.querySelectorAll("img[data-src]"),l=new IntersectionObserver((t,e)=>{t.forEach(n=>{if(n.isIntersecting){const i=n.target;i.src=i.dataset.src,i.removeAttribute("data-src"),l.unobserve(i)}})});o.forEach(t=>l.observe(t))});document.addEventListener("DOMContentLoaded",function(){class o{constructor(){this.client=null,this.cartId=null,this.init()}async init(){typeof ShopifyBuy<"u"&&window.SHOPIFY_CLIENT?(this.client=window.SHOPIFY_CLIENT,await this.getOrCreateCart(),this.bindEvents(),console.log("✅ Shopify Cart API initialized for RejuvenaPod")):setTimeout(()=>this.init(),500)}async getOrCreateCart(){const t=localStorage.getItem("shopify-cart-id");if(t)try{const n=await this.client.checkout.fetch(t);if(!n.completedAt){this.cartId=t,this.updateCartUI(n);return}}catch{console.log("Previous cart not valid, creating new one")}const e=await this.client.checkout.create();this.cartId=e.id,localStorage.setItem("shopify-cart-id",this.cartId),this.updateCartUI(e)}bindEvents(){document.querySelectorAll(".shopify-add-item").forEach(e=>{e.addEventListener("click",async n=>{n.preventDefault();const i=n.target.dataset.variantId,s=n.target.dataset.productTitle;await this.addToCart(i,1,s)})});const t=document.querySelector(".shopify-checkout");t&&t.addEventListener("click",e=>{e.preventDefault(),this.showCartModal()})}async addToCart(t,e,n){try{const i=[{variantId:`gid://shopify/ProductVariant/${t}`,quantity:e}],s=await this.client.checkout.addLineItems(this.cartId,i);this.updateCartUI(s),this.showNotification(`${n} added to cart`)}catch(i){console.error("Error adding to cart:",i),this.showNotification("Error adding product to cart")}}async removeFromCart(t){try{const e=await this.client.checkout.removeLineItems(this.cartId,[t]);this.updateCartUI(e),this.showNotification("Product removed from cart")}catch(e){console.error("Error removing from cart:",e),this.showNotification("Error removing product")}}async updateQuantity(t,e){try{if(e<=0){await this.removeFromCart(t);return}const n=[{id:t,quantity:e}],i=await this.client.checkout.updateLineItems(this.cartId,n);this.updateCartUI(i)}catch(n){console.error("Error updating quantity:",n),this.showNotification("Error updating quantity")}}async showCartModal(){if(this.cartId)try{const t=await this.client.checkout.fetch(this.cartId);this.createCartModal(t)}catch(t){console.error("Error fetching cart:",t)}}createCartModal(t){const e=document.getElementById("cart-modal");e&&e.remove();const n=document.createElement("div");n.id="cart-modal",n.style.cssText=`
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                justify-content: center; align-items: center; font-family: var(--base-font);
            `;const i=document.createElement("div");i.style.cssText=`
                background: white; border-radius: 12px; padding: 30px; 
                max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;
                position: relative;
            `;let s="";t.lineItems&&t.lineItems.length>0?t.lineItems.forEach(a=>{s+=`
                        <div class="cart-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e2e8f0;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 5px 0; font-size: 1.6rem;">${a.title}</h4>
                                <p style="margin: 0; color: #666; font-size: 1.5rem;">$${a.variant.price.amount}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="qty-btn" data-action="decrease" data-line-id="${a.id}" 
                                        style="width: 20px; height: 40px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">-</button>
                                <span style="min-width: 20px; text-align: center; font-weight: 600;">${a.quantity}</span>
                                <button class="qty-btn" data-action="increase" data-line-id="${a.id}" 
                                        style="width: 20px; height: 40px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">+</button>
                                <button class="remove-btn" data-line-id="${a.id}" 
                                        style="background: #ef4444; color: white; border: none; padding: 0px 10px; border-radius: 4px; cursor: pointer; margin-left: 10px;">Remove</button>
                            </div>
                        </div>
                    `}):s='<p style="text-align: center; color: #666; padding: 40px 0;">Your cart is empty</p>',i.innerHTML=`
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #1a202c;">Shopping Cart</h3>
                    <button id="close-modal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                </div>
                <div id="cart-items">
                    ${s}
                </div>
                ${t.lineItems&&t.lineItems.length>0?`
                    <div style="border-top: 2px solid #e2e8f0; padding-top: 20px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <strong style="font-size: 1.8rem;">Total: $${t.totalPrice.amount}</strong>
                        </div>
                        <button id="checkout-btn" style="width: 100%; background: #2596be; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                            Proceed to Checkout
                        </button>
                    </div>
                `:""}
            `,n.appendChild(i),document.body.appendChild(n),document.getElementById("close-modal").addEventListener("click",()=>n.remove()),n.addEventListener("click",a=>{a.target===n&&n.remove()}),t.lineItems&&t.lineItems.length>0&&document.getElementById("checkout-btn").addEventListener("click",()=>{n.remove(),this.openShopifyCheckout()}),document.querySelectorAll(".qty-btn").forEach(a=>{a.addEventListener("click",async u=>{const r=u.target.dataset.lineId,d=u.target.dataset.action,c=t.lineItems.find(h=>h.id===r);if(c){const h=d==="increase"?c.quantity+1:c.quantity-1;await this.updateQuantity(r,h),n.remove(),setTimeout(()=>this.showCartModal(),100)}})}),document.querySelectorAll(".remove-btn").forEach(a=>{a.addEventListener("click",async u=>{const r=u.target.dataset.lineId;await this.removeFromCart(r),n.remove(),setTimeout(()=>this.showCartModal(),100)})})}async openShopifyCheckout(){if(this.cartId)try{const t=await this.client.checkout.fetch(this.cartId);window.location.href=t.webUrl}catch(t){console.error("Error opening checkout:",t)}}updateCartUI(t){const e=document.querySelector(".shopify-cart-count");if(e&&t.lineItems){const n=t.lineItems.reduce((i,s)=>i+s.quantity,0);e.textContent=n.toString()}}showNotification(t){const e=document.createElement("div");e.style.cssText=`
                position: fixed; top: 20px; right: 20px; background: #2596be; color: white;
                padding: 15px 20px; border-radius: 8px; z-index: 10000; font-weight: 600;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1); font-family: var(--base-font);
            `,e.textContent=t,document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},3e3)}}window.shopifyCart=new o});document.addEventListener("DOMContentLoaded",function(){setTimeout(m,100)});function m(){const o=document.getElementById("financing-modal"),l=document.getElementById("close-financing-modal"),t=document.getElementById("how-found-us"),e=document.getElementById("other-source-group");document.querySelectorAll('.pricing-cta, .cta-secondary, button[class*="secondary"]').forEach(r=>{const d=r.textContent.toLowerCase();(d.includes("monthly")||d.includes("financing")||d.includes("payment"))&&r.addEventListener("click",c=>{c.preventDefault(),s()})}),l&&l.addEventListener("click",a),o&&o.addEventListener("click",r=>{r.target===o&&a()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&o&&o.style.display==="block"&&a()}),t&&e&&t.addEventListener("change",function(){if(this.value==="other")e.style.display="block";else{e.style.display="none";const r=document.getElementById("other-source");r&&(r.value="")}});const i=document.getElementById("financingForm");i&&i.addEventListener("submit",async function(r){r.preventDefault(),await u(this)});function s(){o&&(o.style.display="block",document.body.style.overflow="hidden",console.log("💰 Financing modal opened"))}function a(){o&&(o.style.display="none",document.body.style.overflow="auto")}async function u(r){const d=document.getElementById("financing-form-feedback"),c=document.querySelector(".financing-submit-btn");c&&(c.innerHTML="Processing Request...",c.disabled=!0);try{(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(new FormData(r)).toString()})).ok&&(d&&(d.innerHTML=`
                        <div style="background: #d4edda; color: #155724; padding: 25px; border-radius: 15px; text-align: center; border: 2px solid #c3e6cb;">
                            <h3 style="margin: 0 0 15px 0; font-size: 1.7rem;">✅ Request Submitted Successfully!</h3>
                            <p style="margin: 0; font-size: 1.5rem; line-height: 1.5;">Thank you for your interest in financing. Our team will review your request and send you all the necessary documentation within 24-48 hours. Check your email for updates!</p>
                        </div>
                    `,d.style.display="block"),r.reset(),c&&(c.style.display="none"),setTimeout(()=>{a()},5e3))}catch(h){console.error("Error submitting financing form:",h),d&&(d.innerHTML=`
                    <div style="background: #f8d7da; color: #721c24; padding: 20px; border-radius: 10px; text-align: center;">
                        ❌ Something went wrong. Please try again or contact us directly at admin@anywherehealing.com
                    </div>
                `,d.style.display="block"),c&&(c.innerHTML="Try Again",c.disabled=!1)}}}
